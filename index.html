<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BlocklyNavy</title>
  <script src="blockly_compressed.js"></script>
  <script src="blocks_compressed.js"></script>
  <script src="javascript_compressed.js"></script>
  <script src="msg/js/en.js"></script>
  <script src="acorn.js"></script>
    <script src="interpreter.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    
      #blocklyDiv{
      position: absolute ;
      top: 8px;
      right: 200px;
      font-size: 18px;

      }
      img {
       display:none
      }
      #gameScreen {
        border: 1px solid black;
        background-color: aquamarine;
      }
      
      #healthCanvas{
            position: absolute ;
            top: 650px;
            left: 0px;
      }
      
  </style>
</head>
<body>

  
    <img id="playerUp" src="Assets/PlayerUp.png" />
    <img id="playerDown" src="Assets/PlayerDown.png" />
    <img id ="enemyLeft" src="Assets/EnemyShipLeft.png"/>
    <img id ="enemyRight" src="Assets/EnemyShipRight.png"/>
    <img id ="enemyStart" src="Assets/EnemyStart.png"/>
    <img id ="ballImage" src="Assets/ball.png"/>
    <img id="lvlImage" src="Assets/label.jpeg"/>
    <img id="1Image" src="Assets/1.jpeg"/>
    <img id="2Image" src="Assets/2.jpeg"/>
    <img id="3Image" src="Assets/3.jpeg"/>
    <img id="4Image" src="Assets/4.jpeg"/>
    <img id="5Image" src="Assets/5.jpeg"/>
    <img id="fire" src="Assets/fire.png"/>
    <img id="fire2" src="Assets/fireVuelta.png"/>
    
    <canvas id="gameScreen" float ="left" width="600" height="600"></canvas>
    <canvas id ="healthCanvas" width= "600" height="400"></canvas>
    <script src="src/player.js"></script>
    <script src="src/ball.js"></script>
    <script src="src/healthBar.js"></script>
    <script src="src/healthLogic.js"></script>
    <script src="src/game.js"></script>
    
  <p>
    <button id="play1" onclick="showCode()">Show the code</button>
    <button id="codeShow" onclick="runCode()">Play</button>
    <button id="restart" onclick="restart()">Restart</button>
    <button id="NextLVL" onclick="NextLVL()">Next Level</button>
    <button id="PreviousLVL" onclick="PreviousLVL()">Previous Level</button>
  </p>
  
  <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>

  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
                  <category name="Loops">
                    <block type="controls_whileUntil">
                      <field name="MODE">WHILE</field>
                    </block>
                    <block type="controls_repeat_ext">
                    <value name="TIMES">
                      <shadow type="math_number">
                        <field name="NUM">10</field>
                      </shadow>
                    </value>
                  </block>
                  </category>
                  <category name="Logic">
                    <block type="controls_if"></block>
                    <block type="logic_boolean">
                      <field name="BOOL">TRUE</field>
                    </block>
                  </category>
                  <category name="Boat Orders">
                    <block type="Cannon">
                      <field name="Angle Of shoot">90</field>
                      <field name="NAME">0</field>
                    </block>
                    <block type="Radar">
                      <field name="Scan direction">60</field>
                    </block>
                    <block type="Move">
                      <field name="Angle">90</field>
                      <field name="Distance">0</field>
                    </block>
                  </category>
             </xml>

  



    <script src="Blocks/Cannon.js"></script>
    <script src="Blocks/string_length.js"></script>
    <script src="Blocks/Move.js"></script>
    <script src="Blocks/Radar.js"></script>
    
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox')});

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      alert(code);
    }

    function runCode() {
      // Generate JavaScript code and run it.
      gameState="PLAY";
     
      
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = 0;
       //var code = 'player.move(0,100)';
            var initFunc = function(interpreter, globalObject) {
          // Create 'robot' global object.
          var player = interpreter.nativeToPseudo({});
          var ball = interpreter.nativeToPseudo({});
          interpreter.setProperty(globalObject, 'player', player);
          interpreter.setProperty(globalObject, 'ball', ball);
          interpreter.setProperty(globalObject,"text",String);

          // Define 'player.angle' and distance property.
          interpreter.setProperty(player, 'angle', 360);
          interpreter.setProperty(player, 'distance', 200);
          interpreter.setProperty(ball, 'angle', 360);
          interpreter.setProperty(ball, 'distance', 400);

          // Define 'robot.forwards' function.
          var wrapper = function move(angle,distance) {
            return realPlayer.move(angle,distance);
          };
          
          interpreter.setProperty(player, 'move',
              interpreter.createNativeFunction(wrapper));


          var wrapper = function shoot(angle,distance) {
            return playerBall.shoot(angle,distance);
          };

          interpreter.setProperty(ball, 'move',
              interpreter.createNativeFunction(wrapper));

          var wrapper = function radar(text){
                return playerBall.radar(text);
          };

          interpreter.setProperty(globalObject, 'radar',
              interpreter.createNativeFunction(wrapper));

            };
        var myInterpreter = new Interpreter(code, initFunc);
    
          try {

      
         myInterpreter.run();
      
          } catch (e) {
            alert(e);
          }
    }
    function restart(){
       gameState="STOP";
    }
    function NextLVL(){
        if(level<=4){
          level= level+1;
          realPlayer.restart(realPlayer,100,200);
          enemyPlayer.restart(enemyPlayer,300,200);
          playerBall.reset(realPlayer);
          playerHealthBar.reset();
          enemyHealthBar.reset();
        }
   
           
        
    }
     function PreviousLVL(){
        if(level>2){
            level= level-1;
            realPlayer.restart(realPlayer,100,200);
            enemyPlayer.restart(enemyPlayer,300,200);
            playerBall.reset(realPlayer);
            playerHealthBar.reset();
            enemyHealthBar.reset();
        }else if(level=2){
            level= level-1;
            realPlayer.restart(realPlayer,100,200);
            enemyPlayer.restart(enemyPlayer,300,200);
            playerBall.reset(realPlayer);
            playerHealthBar.reset();
            enemyHealthBar.reset();
            enemyHealthBar.updateHealth(90);
      
        }
    }
  </script>

</body>
</html>
